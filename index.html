<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#fdf2f8">
    <title>For My Valentine | A Special Surprise</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- GSAP for Animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600;700&family=Dancing+Script:wght@400;500;600;700&family=Nunito:wght@300;400;600;700&family=Playfair+Display:wght@400;500;600;700;800;900&family=Inter:wght@300;400;500;600;700&family=Caveat:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Tailwind Configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        valentine: {
                            50: '#fff1f2',
                            100: '#ffe4e6',
                            200: '#fecdd3',
                            300: '#fda4af',
                            400: '#fb7185',
                            500: '#f43f5e',
                            600: '#e11d48',
                            700: '#be123c',
                            800: '#9f1239',
                            900: '#881337',
                            950: '#4c0519',
                        },
                        gold: {
                            50: '#fffdf7',
                            100: '#fef9e7',
                            200: '#fef3c7',
                            300: '#fcd34d',
                            400: '#fbbf24',
                            500: '#f59e0b',
                        }
                    },
                    fontFamily: {
                        sans: ['Fredoka', 'sans-serif'],
                        hand: ['Dancing Script', 'cursive'],
                        caveat: ['Caveat', 'cursive'],
                        body: ['Nunito', 'sans-serif'],
                        display: ['Playfair Display', 'serif'],
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'float-delayed': 'float 6s ease-in-out 3s infinite',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'wiggle': 'wiggle 1s ease-in-out infinite',
                        'spin-slow': 'spin 8s linear infinite',
                        'fade-in-up': 'fadeInUp 1s ease-out forwards',
                        'shimmer': 'shimmer 3s linear infinite',
                        'glow': 'glow 2s ease-in-out infinite alternate',
                        'heartbeat': 'heartbeat 1.5s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-20px)' },
                        },
                        wiggle: {
                            '0%, 100%': { transform: 'rotate(-3deg)' },
                            '50%': { transform: 'rotate(3deg)' },
                        },
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        shimmer: {
                            '0%': { backgroundPosition: '-200% 0' },
                            '100%': { backgroundPosition: '200% 0' },
                        },
                        heartbeat: {
                            '0%, 100%': { transform: 'scale(1)' },
                            '14%': { transform: 'scale(1.15)' },
                            '28%': { transform: 'scale(1)' },
                            '42%': { transform: 'scale(1.15)' },
                            '70%': { transform: 'scale(1)' },
                        },
                    }
                }
            }
        }
    </script>

    <style>
        /* --- Global Styles --- */
        body {
            font-family: 'Fredoka', sans-serif;
            overflow-x: hidden;
            background-color: #fff1f2;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="%23f43f5e" stroke="white" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>') 12 12, auto;
        }

        /* --- Scrollbar --- */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #fff1f2; }
        ::-webkit-scrollbar-thumb { background: #fda4af; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #fb7185; }

        /* --- Utilities --- */
        .hidden-page { display: none !important; }
        .gradient-text {
            background: linear-gradient(135deg, #f43f5e 0%, #ec4899 50%, #a855f7 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* --- Cosmic Canvas --- */
        #cosmic-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        .noise-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9998;
            opacity: 0.03;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
        }

        /* --- Background Floating Hearts --- */
        #floating-hearts-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
            overflow: hidden;
        }
        .bg-heart {
            position: absolute;
            bottom: -100px;
            color: rgba(244, 63, 94, 0.2);
            filter: drop-shadow(0 0 2px rgba(255, 255, 255, 0.5));
            animation: floatUpSway linear infinite;
        }
        @keyframes floatUpSway {
            0% { transform: translateY(0) translateX(0) scale(0.5); opacity: 0; }
            10% { opacity: 0.5; }
            50% { transform: translateY(-50vh) translateX(25px) scale(1); }
            100% { transform: translateY(-110vh) translateX(-25px) scale(1.2); opacity: 0; }
        }

        /* --- Transitions --- */
        #iris-overlay {
            position: fixed;
            inset: 0;
            z-index: 9999;
            pointer-events: none;
            display: flex;
            align-items: center;
            justify-content: center;
            clip-path: circle(0% at 50% 50%);
            background: radial-gradient(circle, #f43f5e 0%, #9f1239 100%);
            transition: clip-path 0.8s cubic-bezier(0.7, 0, 0.3, 1), opacity 0.5s ease-out;
            opacity: 1;
        }
        #iris-overlay.expanding { pointer-events: all; clip-path: circle(150% at 50% 50%); }
        #iris-overlay.fading { opacity: 0; pointer-events: none; }
        #fade-overlay {
            position: fixed;
            inset: 0;
            background-color: #fff1f2;
            z-index: 9998;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease-in-out;
        }
        #fade-overlay.active { opacity: 1; pointer-events: all; }

        /* --- Updated Premium Envelope Styles --- */
        .envelope-wrapper {
            position: relative;
            width: 320px;
            height: 220px;
            margin: 0 auto;
            perspective: 1000px;
            cursor: pointer;
            z-index: 40;
        }
        @media (min-width: 768px) { .envelope-wrapper { width: 400px; height: 260px; } }
        
        .envelope-body {
            position: absolute;
            bottom: 0; width: 100%; height: 100%;
            background: #be123c;
            border-radius: 0 0 10px 10px;
            z-index: 10;
            box-shadow: 0 20px 40px -10px rgba(0,0,0,0.5);
        }
        
        .envelope-flap {
            position: absolute; top: 0; width: 100%; height: 100%;
            transform-origin: top;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 20;
        }
        
        .flap-triangle {
            width: 100%; height: 100%;
            background: linear-gradient(to bottom, #f43f5e, #e11d48);
            clip-path: polygon(0 0, 100% 0, 50% 60%);
        }
        
        .envelope-pocket {
            position: absolute; bottom: 0; width: 100%; height: 100%; z-index: 15;
            background: #be123c;
            clip-path: polygon(0 100%, 50% 55%, 100% 100%);
        }
        
        .envelope-side {
            position: absolute; bottom: 0; width: 100%; height: 100%; z-index: 14;
            background: #9f1239;
        }

        .letter-content {
            position: absolute; bottom: 10px; left: 5%; width: 90%; height: 90%;
            background: white;
            transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), z-index 0.1s;
            z-index: 5;
            border-radius: 4px;
            padding: 4px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .letter-content img { width: 100%; height: 100%; object-fit: contain; background: white; }

        /* States */
        .envelope-wrapper.open .envelope-flap { transform: rotateX(180deg); }
        .envelope-wrapper.open .letter-content { transform: translateY(-100px); z-index: 5; }
        .envelope-wrapper .letter-content.popped { transform: translateY(-150px) scale(1.3); z-index: 50; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }

        /* Animations for Prank logic (Required & Adapted for Layout) */
        .seal-crack { animation: sealCrack 0.5s linear; }
        @keyframes sealCrack {
            0%   { transform: translate(-50%, -50%) scale(1) rotate(0deg); }
            25%  { transform: translate(-50%, -50%) scale(1.1) rotate(-4deg); }
            50%  { transform: translate(-50%, -50%) scale(0.95) rotate(3deg); }
            75%  { transform: translate(-50%, -50%) scale(1.05) rotate(-2deg); }
            100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); }
        }
        
        .letter-slide-down { animation: letterDrop 0.6s ease forwards; }
        @keyframes letterDrop {
            0% { transform: translateY(-140px) scale(1.3); opacity: 1; }
            60% { transform: translateY(0px) scale(1); opacity: 1; }
            100% { transform: translateY(200px) scale(0.8); opacity: 0; }
        }

        #letter-overlay-bg { position: absolute; inset: -100vh; background: rgba(0,0,0,0.6); z-index: 35; opacity: 0; pointer-events: none; transition: opacity 0.5s; backdrop-filter: blur(4px); }
        #letter-overlay-bg.active { opacity: 1; pointer-events: all; }

        /* --- Other Elements --- */
        .glass-panel { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.9); }
        .glass-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.06);
            border-radius: 1.5rem;
            transition: all 0.3s ease;
        }
        .music-bar { height: 100%; width: 4px; background: #f43f5e; border-radius: 2px; animation: equalize 1s infinite alternate; }
        @keyframes equalize { 0% { height: 20%; } 100% { height: 100%; } }
        .timeline-line { position: absolute; left: 50%; transform: translateX(-50%); width: 4px; height: 100%; background: #fda4af; border-radius: 2px; }
        .timeline-item:nth-child(odd) { flex-direction: row-reverse; }
        .timeline-item:nth-child(odd) .timeline-content { text-align: left; align-items: flex-start; }
        .timeline-item:nth-child(even) .timeline-content { text-align: right; align-items: flex-end; }
        .timeline-dot { transition: all 0.3s ease; }
        .timeline-item:hover .timeline-dot { transform: scale(1.5); background-color: #e11d48; box-shadow: 0 0 0 4px rgba(225, 29, 72, 0.3); }
        .polaroid { background: white; padding: 1rem 1rem 3rem 1rem; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275), box-shadow 0.3s; position: relative; }
        .polaroid:hover { transform: scale(1.05) rotate(0deg) !important; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15); z-index: 20; }
        #no-btn { transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1), background-color 0.2s; }
        .celebration-heart { position: absolute; bottom: -50px; color: #f43f5e; animation: floatUp linear forwards; z-index: 5; }
        @keyframes floatUp { 
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
        }
    </style>
</head>

<body class="text-gray-800 antialiased selection:bg-pink-200 selection:text-pink-900">

    <!-- AUDIO ASSETS -->
    <audio id="song1" src="song1.mp3" preload="auto" loop></audio>
    <audio id="song2" src="song2.mp3" preload="auto" loop></audio>
    <audio id="song3" src="song3.mp3" preload="auto" loop></audio>
    <audio id="song4" src="song4.mp3" preload="auto" loop></audio>
    <audio id="song5" src="song5.mp3" preload="auto" loop></audio>
    <audio id="song6" src="song6.mp3" preload="auto"></audio>

    <!-- FLOATING HEARTS BACKGROUND -->
    <div id="floating-hearts-container"></div>
    
    <!-- COSMIC CANVAS (New Background for Intro) -->
    <canvas id="cosmic-canvas" class="hidden-page"></canvas>
    
    <!-- NOISE TEXTURE -->
    <div class="noise-overlay"></div>

    <!-- IRIS WIPE OVERLAY -->
    <div id="iris-overlay" class="hidden-page">
        <div class="flex flex-col items-center text-white">
            <i data-lucide="heart" class="w-20 h-20 animate-pulse fill-white"></i>
            <p class="mt-4 font-hand text-2xl tracking-widest">...</p>
        </div>
    </div>

    <!-- NORMAL FADE OVERLAY -->
    <div id="fade-overlay"></div>

    <!-- =========================================
         NEW LOADING SCREEN (Cosmic Style)
         ========================================= -->
    <div id="loading-screen"
        class="fixed inset-0 z-[100] flex flex-col items-center justify-center bg-gradient-to-b from-valentine-50 via-valentine-100 to-valentine-200">

        <!-- Animated Background Orbs -->
        <div class="absolute inset-0 overflow-hidden">
            <div class="absolute top-1/4 left-1/4 w-96 h-96 bg-valentine-300/30 rounded-full blur-3xl animate-pulse-slow"></div>
            <div class="absolute bottom-1/4 right-1/4 w-80 h-80 bg-pink-300/30 rounded-full blur-3xl animate-pulse-slow"></div>
            <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-64 h-64 bg-valentine-400/20 rounded-full blur-2xl animate-float"></div>
        </div>

        <!-- Loading Content -->
        <div class="relative z-10 flex flex-col items-center">
            <!-- Animated Heart Logo -->
            <div class="relative w-32 h-32 mb-8">
                <div class="absolute inset-0 rounded-full bg-valentine-500/20 animate-ping"></div>
                <div class="absolute inset-2 rounded-full border-4 border-valentine-300/50 animate-pulse"></div>
                <div class="absolute inset-4 rounded-full border-4 border-transparent border-t-valentine-500 animate-spin"></div>
                <div class="absolute inset-0 flex items-center justify-center">
                    <i data-lucide="heart" class="w-16 h-16 text-valentine-500 fill-valentine-500 animate-heartbeat drop-shadow-lg"></i>
                </div>
            </div>

            <!-- Loading Text -->
            <h2 id="loading-text" class="text-3xl md:text-4xl font-display font-bold text-valentine-700 mb-4 tracking-wide text-center">
                Preparing Your Surprise
            </h2>
            <p class="text-valentine-500 font-medium mb-8 tracking-wider uppercase text-sm">
                Made with <span class="text-valentine-600">‚ô•</span> just for you
            </p>

            <!-- Progress Bar -->
            <div class="w-72 h-2 bg-white/50 rounded-full overflow-hidden shadow-inner backdrop-blur-sm">
                <div id="loading-bar" class="h-full bg-gradient-to-r from-valentine-400 via-valentine-500 to-pink-500 rounded-full w-0 transition-all duration-[3000ms] ease-out relative">
                    <div class="absolute inset-0 bg-white/30 animate-shimmer" style="background-size: 200% 100%;"></div>
                </div>
            </div>

            <!-- Loading Dots -->
            <div class="flex gap-2 mt-6">
                <div class="w-2 h-2 bg-valentine-400 rounded-full animate-bounce" style="animation-delay: 0ms;"></div>
                <div class="w-2 h-2 bg-valentine-500 rounded-full animate-bounce" style="animation-delay: 150ms;"></div>
                <div class="w-2 h-2 bg-valentine-600 rounded-full animate-bounce" style="animation-delay: 300ms;"></div>
            </div>
        </div>
    </div>

    <!-- =========================================
         NEW PAGE 0: PRE-PROPOSAL TEASER (Cosmic Style)
         ========================================= -->
    <div id="page-pre-proposal"
        class="hidden-page min-h-screen flex flex-col items-center justify-center relative z-10 overflow-hidden bg-gradient-to-b from-valentine-50 via-valentine-100/50 to-white">

        <!-- Animated Orbs -->
        <div class="absolute top-20 left-20 w-32 h-32 bg-valentine-200/50 rounded-full blur-3xl animate-float"></div>
        <div class="absolute bottom-20 right-20 w-40 h-40 bg-pink-200/50 rounded-full blur-3xl animate-float-delayed"></div>
        <div class="absolute top-1/2 left-10 w-24 h-24 bg-valentine-300/30 rounded-full blur-2xl animate-float"></div>

        <!-- Decorative Elements -->
        <div class="absolute top-10 right-10 text-valentine-200/50 animate-spin-slow">
            <i data-lucide="sparkles" class="w-16 h-16"></i>
        </div>
        <div class="absolute bottom-10 left-10 text-valentine-200/50 animate-wiggle">
            <i data-lucide="heart" class="w-12 h-12 fill-current"></i>
        </div>

        <!-- Main Content -->
        <div class="relative z-10 text-center px-6 max-w-3xl mx-auto">
            <div class="mb-8">
                <span class="inline-block px-6 py-2 bg-valentine-100 text-valentine-600 rounded-full text-sm font-semibold tracking-widest uppercase border border-valentine-200/50">
                    A Special Message
                </span>
            </div>

            <h1 class="text-5xl sm:text-6xl md:text-7xl lg:text-8xl font-display font-bold leading-tight mb-8">
                <span class="block gradient-text">I Have A</span>
                <span class="block text-valentine-600 mt-2">Question</span>
                <span class="block text-valentine-800 mt-2">For You...</span>
            </h1>

            <p class="text-xl md:text-2xl text-valentine-600/70 font-caveat tracking-wide font-bold">
                Something I've wanted to ask for a while ‚ú®
            </p>

            <!-- Continue Indicator -->
            <div class="mt-16 animate-bounce">
                <div class="flex flex-col items-center gap-2 text-valentine-400 cursor-pointer" onclick="navigateTo('page-proposal')">
                    <span class="text-sm font-medium tracking-wider uppercase">Tap Anywhere</span>
                    <i data-lucide="chevron-down" class="w-6 h-6"></i>
                </div>
            </div>
        </div>
        <!-- Click area for whole screen navigation -->
        <div class="absolute inset-0 z-0 cursor-pointer" onclick="navigateTo('page-proposal')"></div>
    </div>

    <!-- =========================================
         EXISTING PAGES (Logic Preserved)
         ========================================= -->

    <!-- PAGE 1: PROPOSAL -->
    <div id="page-proposal"
        class="hidden-page flex flex-col items-center justify-center min-h-screen p-4 text-center overflow-hidden relative z-10">
        <div class="absolute top-10 left-10 text-valentine-300 animate-float opacity-50"><i data-lucide="sparkles"
                class="w-12 h-12"></i></div>
        <div class="absolute bottom-20 right-10 text-valentine-300 animate-float-delayed opacity-50"><i
                data-lucide="flower-2" class="w-16 h-16"></i></div>
        <div class="glass-panel p-8 rounded-3xl shadow-2xl max-w-lg w-full transform transition-all hover:scale-[1.01]">
            <img src="https://media.tenor.com/gUiu1zyxfzYAAAAi/bear-kiss-bear-kisses.gif" alt="Cute Bear"
                class="w-48 h-48 mx-auto mb-6 object-cover rounded-2xl shadow-lg" />
            <h1 class="text-4xl md:text-5xl font-bold text-valentine-600 mb-8 font-hand">Will you be mine? ü•∫</h1>

            <div class="mt-4 flex flex-col md:flex-row items-center justify-center gap-6 h-32 relative">
                <button onclick="handleYesClick()" id="yes-btn"
                    class="bg-gradient-to-r from-valentine-500 to-pink-600 hover:from-valentine-600 hover:to-pink-700 text-white font-bold py-4 px-12 rounded-full shadow-lg shadow-valentine-500/40 transition-all duration-300 z-20 text-xl transform hover:-translate-y-1">Yes
                    üíñ</button>
                <button id="no-btn"
                    class="bg-gray-200 hover:bg-gray-300 text-gray-600 font-bold py-4 px-12 rounded-full shadow-md cursor-not-allowed absolute md:static z-10">No</button>
            </div>
            <p class="mt-8 text-xs text-gray-400 uppercase tracking-widest font-semibold">Terms and Conditions Apply
                (You can't say no)</p>
        </div>
    </div>

    <!-- PAGE 2: CELEBRATION -->
    <div id="page-celebration"
        class="hidden-page flex flex-col items-center justify-center min-h-screen p-4 text-center bg-valentine-50 relative z-10 overflow-hidden">
        <button onclick="navigateTo('page-proposal')"
            class="absolute top-6 left-6 z-30 text-gray-400 hover:text-valentine-600 transition-colors p-3 bg-white rounded-full shadow-md hover:shadow-lg group">
            <i data-lucide="arrow-left" class="w-6 h-6 group-hover:-translate-x-1 transition-transform"></i>
        </button>
        <!-- Hearts for this page specifically -->
        <div id="celebration-hearts-container" class="absolute inset-0 pointer-events-none z-0"></div>

        <div class="relative z-10 max-w-2xl w-full">
            <div class="mb-8 relative inline-block">
                <div class="absolute inset-0 bg-yellow-200 rounded-full filter blur-xl opacity-50 animate-pulse"></div>
                <img src="cute2.gif" alt="Celebration Bear"
                    class="w-72 h-72 rounded-2xl shadow-2xl object-cover relative z-10 transform hover:scale-105 transition-transform duration-500" />
            </div>
            <h1 class="text-5xl md:text-7xl font-bold text-valentine-600 mb-6 font-hand animate-bounce drop-shadow-sm">
                Hyyeee ü´†üíñ</h1>
            <div
                class="bg-white/80 backdrop-blur-sm p-6 rounded-2xl shadow-xl mb-8 mx-auto max-w-lg border border-white/50">
                <p class="text-xl md:text-2xl text-gray-700 font-body leading-relaxed">Best. Decision. Ever. <br />You
                    just made me the happiest person in the universe! üåç‚ú®</p>
            </div>
            <button onclick="handleOpenGifts()"
                class="group relative inline-flex items-center justify-center px-8 py-4 font-bold text-white transition-all duration-200 bg-valentine-600 font-lg rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-valentine-600 hover:bg-valentine-700 shadow-lg shadow-valentine-500/50 hover:scale-105">
                <span class="mr-2 text-2xl"></span>
                <span class="text-xl">Open üéÅ</span>
                <i data-lucide="arrow-right" class="ml-2 w-5 h-5 group-hover:translate-x-1 transition-transform"></i>
                <div class="absolute -top-2 -right-2 w-4 h-4 bg-yellow-400 rounded-full animate-ping"></div>
            </button>
        </div>
    </div>

    <!-- PAGE 3: DASHBOARD -->
    <div id="page-dashboard" class="hidden-page min-h-screen bg-gray-50/50 relative z-10 pb-24">
        <header
            class="sticky top-0 bg-white/90 backdrop-blur-md shadow-sm z-40 px-6 py-4 flex items-center justify-between">
            <button onclick="navigateTo('page-celebration')"
                class="p-2 text-gray-500 hover:text-valentine-600 transition-colors rounded-full hover:bg-gray-100">
                <i data-lucide="arrow-left" class="w-6 h-6"></i>
            </button>
            <h2 class="text-2xl font-bold text-gray-800 font-hand">Our Love Dashboard</h2>
            <div class="w-10"></div>
        </header>
        <div class="max-w-6xl mx-auto p-6 pt-8">
            <div class="text-center mb-10">
                <span
                    class="inline-block py-1 px-3 rounded-full bg-valentine-100 text-valentine-600 text-xs font-bold tracking-wider uppercase mb-2">For
                    My Chipkali</span>
                <h2 class="text-3xl md:text-4xl font-bold text-gray-800 mb-3"></h2>
                <p class="text-gray-500 max-w-md mx-auto">Explore the little things that matter.</p>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- App 1: Quiz -->
                <button onclick="navigateTo('page-quiz')"
                    class="group bg-white p-6 rounded-3xl shadow-sm hover:shadow-xl transition-all duration-300 border border-gray-100 hover:border-purple-200 text-left relative overflow-hidden">
                    <div
                        class="absolute top-0 right-0 w-32 h-32 bg-purple-50 rounded-bl-full -mr-8 -mt-8 transition-transform group-hover:scale-110">
                    </div>
                    <div class="relative z-10 flex flex-col h-full">
                        <div
                            class="w-14 h-14 bg-purple-100 text-purple-600 rounded-2xl flex items-center justify-center mb-4 shadow-inner">
                            <i data-lucide="brain-circuit" class="w-7 h-7"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800 mb-1 group-hover:text-purple-600 transition-colors">
                            Love Quiz</h3>
                        <p class="text-gray-500 text-sm mb-4">Test your knowledge about us!</p>
                        <div class="mt-auto flex items-center text-purple-500 text-sm font-semibold">Play Now <i
                                data-lucide="chevron-right" class="w-4 h-4 ml-1"></i></div>
                    </div>
                </button>
                <!-- App 2: Gallery -->
                <button onclick="navigateTo('page-gallery')"
                    class="group bg-white p-6 rounded-3xl shadow-sm hover:shadow-xl transition-all duration-300 border border-gray-100 hover:border-blue-200 text-left relative overflow-hidden">
                    <div
                        class="absolute top-0 right-0 w-32 h-32 bg-blue-50 rounded-bl-full -mr-8 -mt-8 transition-transform group-hover:scale-110">
                    </div>
                    <div class="relative z-10 flex flex-col h-full">
                        <div
                            class="w-14 h-14 bg-blue-100 text-blue-600 rounded-2xl flex items-center justify-center mb-4 shadow-inner">
                            <i data-lucide="images" class="w-7 h-7"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800 mb-1 group-hover:text-blue-600 transition-colors">
                            Memory Lane</h3>
                        <p class="text-gray-500 text-sm mb-4">Snapshots of our best moments.</p>
                        <div class="mt-auto flex items-center text-blue-500 text-sm font-semibold">View Album <i
                                data-lucide="chevron-right" class="w-4 h-4 ml-1"></i></div>
                    </div>
                </button>
                <!-- App 3: Letter (UPDATED) -->
                <button onclick="navigateTo('page-letter')"
                    class="group bg-white p-6 rounded-3xl shadow-sm hover:shadow-xl transition-all duration-300 border border-gray-100 hover:border-red-200 text-left relative overflow-hidden">
                    <div
                        class="absolute top-0 right-0 w-32 h-32 bg-red-50 rounded-bl-full -mr-8 -mt-8 transition-transform group-hover:scale-110">
                    </div>
                    <div class="relative z-10 flex flex-col h-full">
                        <div
                            class="w-14 h-14 bg-red-100 text-red-600 rounded-2xl flex items-center justify-center mb-4 shadow-inner">
                            <i data-lucide="mail-heart" class="w-7 h-7"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800 mb-1 group-hover:text-red-600 transition-colors">Love
                            Letter</h3>
                        <p class="text-gray-500 text-sm mb-4">Something I wrote for you.</p>
                        <div class="mt-auto flex items-center text-red-500 text-sm font-semibold">Read It <i
                                data-lucide="chevron-right" class="w-4 h-4 ml-1"></i></div>
                    </div>
                </button>
                <!-- App 4: Timeline -->
                <button onclick="navigateTo('page-timeline')"
                    class="group bg-white p-6 rounded-3xl shadow-sm hover:shadow-xl transition-all duration-300 border border-gray-100 hover:border-green-200 text-left relative overflow-hidden">
                    <div
                        class="absolute top-0 right-0 w-32 h-32 bg-green-50 rounded-bl-full -mr-8 -mt-8 transition-transform group-hover:scale-110">
                    </div>
                    <div class="relative z-10 flex flex-col h-full">
                        <div
                            class="w-14 h-14 bg-green-100 text-green-600 rounded-2xl flex items-center justify-center mb-4 shadow-inner">
                            <i data-lucide="history" class="w-7 h-7"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800 mb-1 group-hover:text-green-600 transition-colors">
                            Our Journey</h3>
                        <p class="text-gray-500 text-sm mb-4">How it all started vs now.</p>
                        <div class="mt-auto flex items-center text-green-500 text-sm font-semibold">Travel Time <i
                                data-lucide="chevron-right" class="w-4 h-4 ml-1"></i></div>
                    </div>
                </button>
                <!-- App 5: Reason Generator -->
                <button onclick="navigateTo('page-reasons')"
                    class="group bg-white p-6 rounded-3xl shadow-sm hover:shadow-xl transition-all duration-300 border border-gray-100 hover:border-yellow-200 text-left relative overflow-hidden">
                    <div
                        class="absolute top-0 right-0 w-32 h-32 bg-yellow-50 rounded-bl-full -mr-8 -mt-8 transition-transform group-hover:scale-110">
                    </div>
                    <div class="relative z-10 flex flex-col h-full">
                        <div
                            class="w-14 h-14 bg-yellow-100 text-yellow-600 rounded-2xl flex items-center justify-center mb-4 shadow-inner">
                            <i data-lucide="list-heart" class="w-7 h-7"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800 mb-1 group-hover:text-yellow-600 transition-colors">
                            Why I Love You</h3>
                        <p class="text-gray-500 text-sm mb-4">Infinite reasons why.</p>
                        <div class="mt-auto flex items-center text-yellow-500 text-sm font-semibold">See Reasons <i
                                data-lucide="chevron-right" class="w-4 h-4 ml-1"></i></div>
                    </div>
                </button>
            </div>
            <div class="mt-16 text-center">
                <p class="text-gray-400 text-xs flex items-center justify-center gap-1">Created with <i
                        data-lucide="code-2" class="w-3 h-3"></i> & <i data-lucide="coffee" class="w-3 h-3"></i> for my
                    one & only.</p>
            </div>
        </div>
        <!-- Music Player -->
        <div
            class="fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-80 bg-white/90 backdrop-blur-md rounded-2xl shadow-2xl p-4 border border-gray-200 z-50 flex items-center gap-4 transition-transform transform hover:-translate-y-1">
            <div
                class="w-12 h-12 bg-gradient-to-br from-valentine-400 to-purple-500 rounded-full flex items-center justify-center text-white shadow-md animate-spin-slow">
                <i data-lucide="music" class="w-6 h-6"></i>
            </div>
            <div class="flex-1 min-w-0">
                <h4 id="music-title" class="text-sm font-bold text-gray-800 truncate">Romantic Vibes</h4>
                <div class="flex items-center gap-1 h-3 mt-1">
                    <div class="music-bar" style="animation-duration: 0.8s"></div>
                    <div class="music-bar" style="animation-duration: 1.2s"></div>
                    <div class="music-bar" style="animation-duration: 0.5s"></div>
                    <div class="music-bar" style="animation-duration: 1.0s"></div>
                    <p id="music-status" class="text-xs text-gray-500 ml-2">Playing...</p>
                </div>
            </div>
            <button onclick="toggleMusicState()"
                class="p-2 bg-gray-100 rounded-full hover:bg-valentine-100 hover:text-valentine-600 transition">
                <i id="music-toggle-icon" data-lucide="pause" class="w-5 h-5"></i>
            </button>
        </div>
    </div>

    <!-- PAGE 4: QUIZ -->
    <div id="page-quiz" class="hidden-page min-h-screen flex flex-col items-center justify-center p-4 z-10 relative">
        <button onclick="navigateTo('page-dashboard')"
            class="absolute top-6 left-6 z-20 text-white hover:text-purple-200 transition-colors p-2 bg-black/20 rounded-full backdrop-blur-sm">
            <i data-lucide="arrow-left" class="w-6 h-6"></i>
        </button>
        <div class="absolute top-0 left-0 w-full h-full bg-purple-50 z-0">
            <div
                class="absolute top-[-10%] right-[-10%] w-[50%] h-[50%] bg-purple-200 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob">
            </div>
            <div
                class="absolute bottom-[-10%] left-[-10%] w-[50%] h-[50%] bg-pink-200 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob animation-delay-2000">
            </div>
        </div>
        <div
            class="bg-white p-8 md:p-10 rounded-3xl shadow-2xl w-full max-w-lg relative z-10 border-4 border-purple-100">
            <div
                class="w-16 h-16 bg-purple-100 rounded-2xl flex items-center justify-center mb-6 mx-auto text-purple-600">
                <i data-lucide="brain-circuit" class="w-8 h-8"></i>
            </div>
            <div id="quiz-content" class="min-h-[300px] flex flex-col justify-center"></div>
            <div id="quiz-result" class="hidden text-center py-4">
                <div
                    class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6 text-green-500 animate-bounce">
                    <i data-lucide="trophy" class="w-12 h-12 fill-current"></i>
                </div>
                <h3 class="text-4xl font-bold text-gray-800 mb-2">Perfect Score!</h3>
                <p class="text-gray-500 mb-8 text-lg">You know me better than I know myself! ‚ù§Ô∏è</p>
                <button onclick="navigateTo('page-dashboard')"
                    class="w-full bg-purple-600 text-white px-8 py-4 rounded-xl font-bold shadow-lg hover:bg-purple-700 transition transform hover:-translate-y-1">Claim
                    Your Prize (Go Back)</button>
            </div>
        </div>
    </div>

    <!-- PAGE 5: GALLERY -->
    <div id="page-gallery" class="hidden-page min-h-screen bg-blue-50/50 p-6 pt-24 pb-20 relative z-10">
        <div class="fixed top-0 left-0 w-full bg-white/80 backdrop-blur-md z-30 p-4 shadow-sm flex items-center gap-4">
            <button onclick="navigateTo('page-dashboard')"
                class="p-2 bg-gray-100 rounded-full hover:bg-blue-100 text-gray-600 hover:text-blue-600 transition">
                <i data-lucide="arrow-left" class="w-6 h-6"></i>
            </button>
            <h2 class="text-2xl font-bold text-gray-800 font-hand">Our Treasure </h2>
        </div>
        <div class="max-w-5xl mx-auto">
            <div class="columns-1 md:columns-2 lg:columns-3 gap-8 space-y-8">
                <div class="polaroid break-inside-avoid">
                    <div class="aspect-[3/4] overflow-hidden bg-gray-100 mb-4 rounded-sm">
                        <img src="https://images.unsplash.com/photo-1518199266791-5375a83190b7?auto=format&fit=crop&w=600&q=80"
                            alt="Date"
                            class="w-full h-full object-cover transform hover:scale-110 transition-transform duration-700">
                    </div>
                    <p class="handwriting text-3xl text-center text-gray-700">First Date Jitters</p>
                    <p class="text-xs text-center text-gray-400 mt-1">Feb 14, 2023</p>
                </div>
                <div class="polaroid break-inside-avoid rotate-1">
                    <div class="aspect-square overflow-hidden bg-gray-100 mb-4 rounded-sm">
                        <img src="https://images.unsplash.com/photo-1621609764180-2ca554a9d6f2?auto=format&fit=crop&w=600&q=80"
                            alt="Faces"
                            class="w-full h-full object-cover transform hover:scale-110 transition-transform duration-700">
                    </div>
                    <p class="handwriting text-3xl text-center text-gray-700">Goofy Modes</p>
                </div>
                <div class="polaroid break-inside-avoid -rotate-1">
                    <div class="aspect-[4/3] overflow-hidden bg-gray-100 mb-4 rounded-sm">
                        <img src="https://images.unsplash.com/photo-1522075469751-3a6694fb2f61?auto=format&fit=crop&w=600&q=80"
                            alt="Trip"
                            class="w-full h-full object-cover transform hover:scale-110 transition-transform duration-700">
                    </div>
                    <p class="handwriting text-3xl text-center text-gray-700">Adventure Time</p>
                </div>
                <div class="polaroid break-inside-avoid rotate-2">
                    <div class="aspect-[3/4] overflow-hidden bg-gray-100 mb-4 rounded-sm">
                        <img src="https://images.unsplash.com/photo-1529333166437-7750a6dd5a70?auto=format&fit=crop&w=600&q=80"
                            alt="Us"
                            class="w-full h-full object-cover transform hover:scale-110 transition-transform duration-700">
                    </div>
                    <p class="handwriting text-3xl text-center text-gray-700">Just Us</p>
                </div>
                <div class="polaroid break-inside-avoid -rotate-2">
                    <div class="aspect-square overflow-hidden bg-gray-100 mb-4 rounded-sm">
                        <img src="https://images.unsplash.com/photo-1516589178581-6cd7833ae3b2?auto=format&fit=crop&w=600&q=80"
                            alt="Hugs"
                            class="w-full h-full object-cover transform hover:scale-110 transition-transform duration-700">
                    </div>
                    <p class="handwriting text-3xl text-center text-gray-700">Warm Hugs</p>
                </div>
            </div>
            <div class="text-center mt-16 pb-8">
                <p class="text-gray-500 italic font-medium">"Every picture tells a story, but ours is my favorite
                    novel."</p>
            </div>
        </div>
    </div>

    <!-- PAGE 6: LETTER (Updated Visuals with Original Logic) -->
    <div id="page-letter" class="hidden-page min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-[#4a0404] to-[#2b0202] relative z-10 overflow-hidden">
        <button onclick="navigateTo('page-dashboard')" class="absolute top-6 left-6 text-white/50 hover:text-white z-30 transition hover:scale-110">
            <i data-lucide="arrow-left" class="w-8 h-8"></i>
        </button>
        
        <div id="letter-overlay-bg" onclick="handleCloseLetter()"></div>
        <div id="letter-hearts-container" class="absolute inset-0 pointer-events-none z-0"></div>

        <p class="absolute top-24 text-red-200/80 font-hand text-2xl animate-pulse z-20">Tap the seal to open...</p>

        <!-- New Envelope Wrapper with Old ID -->
        <div class="envelope-wrapper relative z-40" id="main-envelope" onclick="toggleLetter()">
            <div class="envelope-body">
                <div class="absolute inset-0 opacity-20 bg-[url('https://www.transparenttextures.com/patterns/dark-leather.png')]"></div>
            </div>
            
            <div class="letter-content shadow-xl" id="letter-content-el">
                <!-- Close Button using inline click handler like new code -->
                <div class="absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full cursor-pointer z-50 hover:scale-110 transition letter-close-btn" onclick="event.stopPropagation(); handleCloseLetter()">
                    <i data-lucide="x" class="w-4 h-4"></i>
                </div>
                <!-- ID matches original logic -->
                <img id="letter-image" src="001.png" alt="Letter Content" class="w-full h-full object-contain rounded bg-white">
            </div>
            
            <div class="envelope-pocket"></div>
            <div class="envelope-side" style="clip-path: polygon(0 0, 0 100%, 50% 55%);"></div>
            <div class="envelope-side" style="clip-path: polygon(100% 0, 100% 100%, 50% 55%); background: #881337;"></div>
            
            <div class="envelope-flap">
                <div class="flap-triangle"></div>
                <!-- Seal logic maintained -->
                <div class="wax-seal absolute top-[45%] left-1/2 -translate-x-1/2 -translate-y-1/2 w-14 h-14 bg-gradient-to-br from-[#9f1239] to-[#881337] rounded-full flex items-center justify-center shadow-lg border border-[#be123c]">
                    <i data-lucide="heart" class="w-6 h-6 text-red-200 fill-red-200"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- PAGE 7: TIMELINE -->
    <div id="page-timeline" class="hidden-page min-h-screen bg-green-50 p-6 pt-24 z-10 relative">
        <div class="fixed top-0 left-0 w-full bg-white/80 backdrop-blur-md z-30 p-4 shadow-sm flex items-center gap-4">
            <button onclick="navigateTo('page-dashboard')"
                class="p-2 bg-gray-100 rounded-full hover:bg-green-100 text-gray-600 hover:text-green-600 transition">
                <i data-lucide="arrow-left" class="w-6 h-6"></i>
            </button>
            <h2 class="text-2xl font-bold text-gray-800 font-hand">Our Story So Far...</h2>
        </div>
        <div class="max-w-3xl mx-auto relative pt-8 pb-20">
            <div class="timeline-line"></div>
            <div id="timeline-container" class="space-y-12"></div>
        </div>
    </div>

    <!-- PAGE 8: REASONS -->
    <div id="page-reasons"
        class="hidden-page min-h-screen bg-yellow-50 flex flex-col items-center justify-center p-6 z-10 relative">
        <button onclick="navigateTo('page-dashboard')"
            class="absolute top-6 left-6 text-gray-400 hover:text-yellow-600 z-20">
            <i data-lucide="arrow-left" class="w-8 h-8"></i>
        </button>
        <div class="relative w-full max-w-md aspect-[3/4]">
            <div
                class="absolute top-0 left-0 w-full h-full bg-white rounded-3xl shadow-sm transform rotate-3 scale-95 opacity-50 border border-gray-200">
            </div>
            <div
                class="absolute top-0 left-0 w-full h-full bg-white rounded-3xl shadow-sm transform -rotate-2 scale-98 opacity-70 border border-gray-200">
            </div>
            <div id="reason-card"
                class="absolute top-0 left-0 w-full h-full bg-white rounded-3xl shadow-2xl border border-gray-100 flex flex-col items-center justify-center p-8 text-center transition-all duration-500 transform">
                <div class="w-20 h-20 bg-yellow-100 rounded-full flex items-center justify-center mb-8 text-yellow-500">
                    <i data-lucide="heart" class="w-10 h-10 fill-current"></i>
                </div>
                <h3 class="text-gray-400 text-sm uppercase tracking-widest font-bold mb-4">Reason #<span
                        id="reason-number">1</span></h3>
                <p id="reason-text" class="text-3xl font-hand text-gray-800 leading-normal">Because you make me smile
                    even when I don't want to smile.</p>
                <p class="mt-12 text-xs text-gray-400">Tap for next reason</p>
            </div>
            <div class="absolute inset-0 z-30 cursor-pointer" onclick="nextReason()"></div>
        </div>
    </div>

    <!-- BROKEN HEART MODAL (Original Logic) -->
    <div id="modal-broken-heart"
        class="hidden-page fixed inset-0 z-[70] flex flex-col items-center justify-center bg-black/95 text-white p-4">
        <div class="animate-in fade-in zoom-in duration-500 flex flex-col items-center">
            <i data-lucide="heart-crack"
                class="text-red-600 mb-6 animate-pulse w-40 h-40 fill-red-600 filter drop-shadow-[0_0_15px_rgba(220,38,38,0.8)]"></i>
            <h2 class="text-4xl md:text-6xl font-black text-center mb-4 tracking-wider leading-tight">HYEEEE MAI
                TOH<br />TUT GAYA üíî</h2>
            <div class="flex gap-2 mb-8 items-end h-16">
                <div class="w-3 bg-red-500 animate-[bounce_1s_infinite] h-4 rounded-t"></div>
                <div class="w-3 bg-red-500 animate-[bounce_1.2s_infinite] h-10 rounded-t"></div>
                <div class="w-3 bg-red-500 animate-[bounce_0.8s_infinite] h-6 rounded-t"></div>
                <div class="w-3 bg-red-500 animate-[bounce_1.5s_infinite] h-14 rounded-t"></div>
                <div class="w-3 bg-red-500 animate-[bounce_1.1s_infinite] h-12 rounded-t"></div>
                <div class="w-3 bg-red-500 animate-[bounce_0.9s_infinite] h-5 rounded-t"></div>
            </div>
            <div id="last-chance-container" class="hidden flex flex-col items-center gap-6 fade-in">
                <p class="text-2xl font-bold tracking-wide text-valentine-200">Last Chance to Fix This ü•∫</p>
                <div class="flex gap-6 justify-center items-center">
                    <button onclick="handleMercyReset()"
                        class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-10 rounded-full text-lg shadow-xl transition-all transform hover:scale-105 hover:shadow-green-500/50">I'm
                        Sorry, Yes!</button>
                    <button id="modal-no-btn"
                        class="bg-gray-700 hover:bg-red-600 text-gray-300 hover:text-white font-bold py-3 px-8 rounded-full text-lg shadow-xl transition-all duration-150 border-2 border-gray-600 hover:border-red-600">Still
                        No</button>
                </div>
            </div>
        </div>
    </div>

    <!-- GAME OVER SCREEN (Original Logic) -->
    <div id="page-game-over"
        class="hidden-page fixed inset-0 bg-black z-[80] flex flex-col items-center justify-center text-white overflow-hidden p-6">
        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] opacity-20 animate-pulse"></div>
        <div id="game-over-content" class="text-center flex flex-col items-center relative z-10">
            <div class="mb-6 relative">
                <i data-lucide="heart-off" class="w-12 h-12 text-valentine-600 absolute bottom-0 right-0 animate-ping"></i>
            </div>
            <h1 class="text-5xl md:text-7xl font-black text-valentine-600 mb-4 tracking-widest uppercase glitch-effect"
                style="text-shadow: 2px 2px 0px #fff;">CHUP CHAP YES KAR</h1>
            <p class="text-2xl md:text-3xl text-gray-300 font-bold tracking-wider mb-8 font-hand">nahi toh üî™üî™üî™</p>
            <div id="game-over-btn-container" class="mt-8 hidden fade-in">
                <button onclick="handleGameOverOk()"
                    class="group relative px-8 py-4 bg-green-500 hover:bg-green-600 text-white font-bold rounded-full text-xl shadow-[0_0_20px_rgba(34,197,94,0.6)] transition-all transform hover:scale-110 active:scale-95">
                    <span class="flex items-center gap-2">
                        <i data-lucide="rotate-ccw"
                            class="w-5 h-5 group-hover:-rotate-180 transition-transform duration-500"></i>
                        yes
                    </span>
                </button>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        /* --- Data Store --- */
        const DB = {
            quiz: [
                { q: "Who is the better cook? üç≥", options: ["Me (Obviously)", "You", "We order out mostly"], correct: 0 },
                { q: "What is my favorite thing about you? ü•∞", options: ["Your Smile", "Your Eyes", "Everything"], correct: 2 },
                { q: "Where should our next date be? üåπ", options: ["Picnic", "Movie Night", "Fancy Dinner"], correct: 0 },
                { q: "Who said 'I love you' first?", options: ["Me", "You", "It was mutual"], correct: 0 }
            ],
            timeline: [
                { date: "Day 1", title: "The Beginning", desc: "The day our worlds collided." },
                { date: "Week 1", title: "First Date", desc: "Awkward but perfect." },
                { date: "Month 1", title: "Making Memories", desc: "Little photos, so many laughs." },
                { date: "Today", title: "Forever", desc: "Asking you to be my Valentine." }
            ],
            reasons: [
                "Your smile lights up the room.",
                "We can talk about anything.",
                "You love me for who I am.",
                "You are also My friend."
            ]
        };

        /* --- State Management --- */
        const State = {
            noCount: 0,
            yesScale: 1,
            chaseStartTime: null,
            isMercyMode: false,
            currentQuizIndex: 0,
            currentReasonIndex: 0,
            currentSongId: 'song1',
            isMusicPlaying: false,
            celebrationInterval: null,
            letterHeartInterval: null,
            hasShownChipkali: false,
            firstLetterSequenceDone: false,
            preProposalTimeout: null
        };

        /* --- Initialization --- */
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            initAudio();
            initNoButton();
            renderQuiz();
            renderTimeline();
            initCosmicCanvas(); // Initialize the cosmic background for new pages
            startNewLoadingSequence(); // Use the new loading sequence
            generateFloatingHearts();
            document.body.addEventListener('click', startMusicSystem, { once: true });
            document.body.addEventListener('touchstart', startMusicSystem, { once: true });
        });

        /* --- New Loading & Pre-Proposal Sequence --- */
        function startNewLoadingSequence() {
            const bar = document.getElementById('loading-bar');
            const text = document.getElementById('loading-text');
            const screen = document.getElementById('loading-screen');
            const cosmicCanvas = document.getElementById('cosmic-canvas');

            // Show cosmic canvas
            if(cosmicCanvas) cosmicCanvas.classList.remove('hidden-page');

            const loadingMessages = [
                "Preparing Your Surprise",
                "Loading Love...",
                "Adding Extra Hearts ‚ù§Ô∏è",
                "Making It Perfect...",
                "Almost Ready!"
            ];

            let msgIndex = 0;
            const msgInterval = setInterval(() => {
                msgIndex = (msgIndex + 1) % loadingMessages.length;
                if (text) text.textContent = loadingMessages[msgIndex];
            }, 700);

            // Animate bar
            setTimeout(() => { if (bar) bar.style.width = "100%"; }, 100);

            // Finish loading
            setTimeout(() => {
                clearInterval(msgInterval);
                if (screen) {
                    screen.style.opacity = '0';
                    screen.style.transition = 'opacity 0.8s ease-out';
                    setTimeout(() => {
                        screen.classList.add('hidden-page');
                        showPreProposal();
                    }, 800);
                }
            }, 3500);
        }

        function showPreProposal() {
            const prePage = document.getElementById('page-pre-proposal');
            if (prePage) prePage.classList.remove('hidden-page');
            // The cosmic canvas remains visible behind this page

            // Auto-navigate after 3 seconds
            State.preProposalTimeout = setTimeout(() => {
                if (State.currentPage === 'page-pre-proposal') {
                    navigateTo('page-proposal');
                }
            }, 3000);
        }

        /* --- Audio System --- */
        function initAudio() {
            const volumes = { song1: 0.8, song2: 0.9, song3: 0.6, song4: 0.7, song5: 0.8, song6: 1.0 };
            Object.keys(volumes).forEach(id => {
                const el = document.getElementById(id);
                if (el) el.volume = volumes[id];
            });
            // Try autoplay
            document.getElementById('song1').play().then(() => {
                State.isMusicPlaying = true;
                updateMusicWidget();
            }).catch(() => console.log("Autoplay blocked"));
        }

        function startMusicSystem() {
            const audio = document.getElementById(State.currentSongId);
            if (audio.paused) playSpecificSong(State.currentSongId);
        }

        function playSpecificSong(songId) {
            ['song1', 'song2', 'song3', 'song4', 'song5', 'song6'].forEach(id => {
                const audio = document.getElementById(id);
                if (id === songId) {
                    audio.play().catch(e => console.log("Interaction needed"));
                    State.isMusicPlaying = true;
                } else {
                    audio.pause();
                    audio.currentTime = 0;
                }
            });
            State.currentSongId = songId;
            updateMusicWidget();
        }

        function toggleMusicState() {
            const audio = document.getElementById(State.currentSongId);
            const icon = document.getElementById('music-toggle-icon');
            const btn = icon.parentElement;
            if (audio.paused) {
                audio.play();
                State.isMusicPlaying = true;
                btn.innerHTML = '<i id="music-toggle-icon" data-lucide="pause" class="w-5 h-5"></i>';
            } else {
                audio.pause();
                State.isMusicPlaying = false;
                btn.innerHTML = '<i id="music-toggle-icon" data-lucide="play" class="w-5 h-5"></i>';
            }
            lucide.createIcons();
            updateMusicWidget();
        }

        function updateMusicWidget() {
            const titles = {
                song1: "Romantic Proposal üéª",
                song2: "Heartbreak Anthem üíî",
                song3: "Celebration Tune üéâ",
                song4: "Chill Vibes ‚òï",
                song5: "My Heart's Voice üíå"
            };
            const titleEl = document.getElementById('music-title');
            if(titleEl) titleEl.innerText = titles[State.currentSongId];
            
            const statusEl = document.getElementById('music-status');
            if(statusEl) statusEl.innerText = State.isMusicPlaying ? "Playing..." : "Paused";
            
            const bars = document.querySelectorAll('.music-bar');
            bars.forEach(bar => { bar.style.animationPlayState = State.isMusicPlaying ? 'running' : 'paused'; });
        }

        /* --- Navigation & Transitions --- */
        let currentPage = "page-pre-proposal"; 

        function navigateTo(pageId) {
            // Clear auto-navigation timer if user clicks manually
            if (State.preProposalTimeout) {
                clearTimeout(State.preProposalTimeout);
                State.preProposalTimeout = null;
            }

            if (pageId !== 'page-celebration') stopCelebrationHearts();
            
            // Handle Music Transitions
            if (pageId === 'page-proposal') {
                playSpecificSong('song1');
                // Hide cosmic canvas if moving to main proposal
                document.getElementById('cosmic-canvas').classList.add('hidden-page');
            }
            if (pageId === 'page-celebration') {
                playSpecificSong('song3');
                startCelebrationHearts();
            }
            if (pageId === 'page-dashboard') { playSpecificSong('song4'); }
            // Note: Letter page handles its own music inside toggleLetter()

            // Page Transition Logic
            const overlay = document.getElementById(pageId === 'page-celebration' ? 'iris-overlay' : 'fade-overlay');
            
            if (overlay) {
                overlay.classList.remove('hidden-page');
                
                // Trigger appropriate animation class
                if (pageId === 'page-celebration') {
                    requestAnimationFrame(() => overlay.classList.add('expanding'));
                } else {
                    overlay.classList.add('active');
                }

                setTimeout(() => {
                    window.scrollTo(0, 0);
                    const allPages = document.querySelectorAll('[id^="page-"]');
                    allPages.forEach(page => page.classList.add('hidden-page'));
                    
                    const target = document.getElementById(pageId);
                    if (target) {
                        target.classList.remove('hidden-page');
                        lucide.createIcons();
                    }

                    // Reset overlay
                    if (pageId === 'page-celebration') {
                        overlay.classList.add('fading');
                        setTimeout(() => {
                            overlay.classList.remove('expanding', 'fading');
                            overlay.classList.add('hidden-page');
                        }, 500);
                    } else {
                        overlay.classList.remove('active');
                    }
                }, pageId === 'page-celebration' ? 800 : 400);
            } else {
                // Fallback direct navigation
                window.scrollTo(0, 0);
                document.querySelectorAll('[id^="page-"]').forEach(page => page.classList.add('hidden-page'));
                document.getElementById(pageId).classList.remove('hidden-page');
            }
            currentPage = pageId;
        }

        /* --- Original Proposal Logic (Strictly Preserved) --- */
        function initNoButton() {
            const btn = document.getElementById('no-btn');
            const modalBtn = document.getElementById('modal-no-btn');
            if(btn) {
                btn.addEventListener('mouseenter', moveButton);
                btn.addEventListener('touchstart', moveButton);
            }
            if(modalBtn) {
                modalBtn.addEventListener('click', () => {
                    document.getElementById('modal-broken-heart').classList.add('hidden-page');
                    const gameOver = document.getElementById('page-game-over');
                    gameOver.classList.remove('hidden-page');
                    setTimeout(() => { document.getElementById('game-over-btn-container').classList.remove('hidden'); }, 2000);
                });
            }
        }

        function moveButton() {
            if (State.isMercyMode) return;
            const now = Date.now();
            if (!State.chaseStartTime) State.chaseStartTime = now;
            if (now - State.chaseStartTime > 2000) { triggerBrokenHeart(); return; }
            const btn = document.getElementById('no-btn');
            const x = (Math.random() * 200) - 100;
            const y = (Math.random() * 200) - 100;
            btn.style.transform = `translate(${x}px, ${y}px) rotate(${Math.random() * 20 - 10}deg)`;
        }

        function handleYesClick() { navigateTo('page-celebration'); }

        function triggerBrokenHeart() {
            const modal = document.getElementById('modal-broken-heart');
            const lastChance = document.getElementById('last-chance-container');
            modal.classList.remove('hidden-page');
            playSpecificSong('song2');
            lastChance.classList.add('hidden');
            setTimeout(() => { lastChance.classList.remove('hidden'); }, 2000);
        }

        function handleMercyReset() {
            document.getElementById('modal-broken-heart').classList.add('hidden-page');
            document.getElementById('page-game-over').classList.add('hidden-page');
            navigateTo('page-proposal');
            State.isMercyMode = true;
            State.chaseStartTime = null;
            const noBtn = document.getElementById('no-btn');
            if (noBtn) noBtn.style.display = 'none';
            const yesBtn = document.getElementById('yes-btn');
            yesBtn.classList.add('scale-125');
            yesBtn.innerText = "YES üíñ";
        }

        function handleGameOverOk() { handleMercyReset(); }
        function handleOpenGifts() { navigateTo('page-dashboard'); }

        /* --- Feature: Quiz --- */
        function renderQuiz() {
            const container = document.getElementById('quiz-content');
            if (State.currentQuizIndex >= DB.quiz.length) {
                container.classList.add('hidden');
                document.getElementById('quiz-result').classList.remove('hidden');
                return;
            }
            const q = DB.quiz[State.currentQuizIndex];
            let html = `
                <div class="mb-6 fade-in">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs font-bold tracking-wider text-purple-400 uppercase">Question ${State.currentQuizIndex + 1}/${DB.quiz.length}</span>
                        <div class="flex gap-1">${DB.quiz.map((_, i) => `<div class="w-2 h-2 rounded-full ${i <= State.currentQuizIndex ? 'bg-purple-500' : 'bg-gray-200'}"></div>`).join('')}</div>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800 mt-2 leading-tight">${q.q}</h3>
                </div>
                <div class="space-y-3 fade-in">
            `;
            q.options.forEach((opt, idx) => {
                html += `<button onclick="handleQuizAnswer(${idx})" class="w-full text-left p-4 rounded-xl border-2 border-gray-100 hover:border-purple-300 hover:bg-purple-50 transition-all font-medium text-gray-600 active:scale-95">${opt}</button>`;
            });
            html += `</div>`;
            container.innerHTML = html;
        }

        function handleQuizAnswer(idx) { State.currentQuizIndex++; renderQuiz(); }

        /* --- Feature: Timeline --- */
        function renderTimeline() {
            const container = document.getElementById('timeline-container');
            container.innerHTML = DB.timeline.map((item, index) => `
                <div class="timeline-item flex w-full justify-between items-center relative z-10 group">
                    <div class="w-5/12 timeline-content flex flex-col p-4 bg-white rounded-xl shadow-md border-t-4 border-green-400 hover:shadow-lg transition-all">
                        <span class="text-xs font-bold text-green-500 mb-1">${item.date}</span>
                        <h4 class="text-lg font-bold text-gray-800">${item.title}</h4>
                        <p class="text-sm text-gray-500">${item.desc}</p>
                    </div>
                    <div class="absolute left-1/2 transform -translate-x-1/2 w-4 h-4 bg-white border-4 border-green-400 rounded-full timeline-dot z-20"></div>
                    <div class="w-5/12"></div>
                </div>
            `).join('');
        }

        /* --- Feature: Reasons --- */
        function nextReason() {
            const card = document.getElementById('reason-card');
            card.style.transform = 'translateX(120%) rotate(20deg)';
            card.style.opacity = '0';
            setTimeout(() => {
                State.currentReasonIndex = (State.currentReasonIndex + 1) % DB.reasons.length;
                document.getElementById('reason-number').innerText = State.currentReasonIndex + 1;
                document.getElementById('reason-text').innerText = DB.reasons[State.currentReasonIndex];
                card.style.transition = 'none';
                card.style.transform = 'translateX(-100%) rotate(-20deg)';
                setTimeout(() => {
                    card.style.transition = 'all 0.5s ease-out';
                    card.style.transform = 'translateX(0) rotate(0)';
                    card.style.opacity = '1';
                }, 50);
            }, 300);
        }

        /* --- Feature: Letter (USER'S EXACT LOGIC) --- */
        function toggleLetter() {
            const envelope = document.getElementById('main-envelope');
            const letterImg = document.getElementById('letter-image');
            const letterContent = document.getElementById('letter-content-el');
            const overlay = document.getElementById('letter-overlay-bg');
            const song6 = document.getElementById('song6');

            // prevent reopening if already open
            if (letterContent.classList.contains('popped')) return;

            /* ---------- STEP 1 : PRANK IMAGE ---------- */
            letterImg.src = '001.png';
            envelope.classList.add('open');

            setTimeout(() => {
                letterContent.classList.add('popped');
            }, 300);

            playSpecificSong('song6');

            /* ---------- STEP 2 : WHEN SONG 6 ENDS ---------- */
            if (song6) {
                song6.onended = function () {
                    const seal = document.querySelector('.wax-seal');
                    seal.classList.add('seal-crack');

                    setTimeout(() => {
                        seal.classList.remove('seal-crack');
                    }, 500);

                    letterContent.classList.add('letter-slide-down');

                    // close prank letter
                    letterContent.classList.remove('popped');

                    setTimeout(() => {
                        envelope.classList.remove('open');

                        // reopen automatically with real letter
                        setTimeout(() => {
                            letterImg.src = 'myletter.png';
                            envelope.classList.add('open');

                            setTimeout(() => {
                                letterContent.classList.add('popped');
                                overlay.classList.add('active');
                            }, 300);

                            playSpecificSong('song5');
                            startLetterHearts();
                            createHeartBurst();
                        }, 700);
                    }, 500);

                    // reset handler so it works again next time
                    song6.onended = null;
                };
            }
        }

        function handleCloseLetter() {
            stopLetterHearts();
            const envelope = document.getElementById('main-envelope');
            const letterContent = document.getElementById('letter-content-el');
            const overlay = document.getElementById('letter-overlay-bg');
            
            if (!letterContent.classList.contains('popped')) return;
            
            letterContent.classList.remove('popped');
            overlay.classList.remove('active');
            
            setTimeout(() => {
                envelope.classList.remove('open');
            }, 600);
        }

        function createHeartBurst() {
            const container = document.getElementById('letter-hearts-container');
            const envelope = document.getElementById('main-envelope');
            const rect = envelope.getBoundingClientRect();
            
            for (let i = 0; i < 40; i++) {
                const heart = document.createElement('div');
                heart.innerHTML = '‚ù§Ô∏è';
                heart.style.position = 'fixed';
                heart.style.left = (rect.left + rect.width / 2) + 'px';
                heart.style.top = (rect.top + rect.height / 2) + 'px';
                heart.style.fontSize = (Math.random() * 20 + 10) + 'px';
                heart.style.zIndex = '60';
                heart.style.pointerEvents = 'none';
                heart.style.transform = 'translate(-50%, -50%) scale(0)';
                heart.style.transition = 'all 1s cubic-bezier(0.165, 0.84, 0.44, 1)';
                
                container.appendChild(heart);
                
                requestAnimationFrame(() => {
                    const angle = Math.random() * Math.PI * 2;
                    const velocity = Math.random() * 200 + 50;
                    const x = Math.cos(angle) * velocity;
                    const y = Math.sin(angle) * velocity;
                    
                    heart.style.transform = `translate(calc(-50% + ${x}px), calc(-50% + ${y}px)) scale(1)`;
                    heart.style.opacity = '0';
                });
                
                setTimeout(() => heart.remove(), 1000);
            }
        }

        function startLetterHearts() {
            if (State.letterHeartInterval) clearInterval(State.letterHeartInterval);
            const container = document.getElementById('letter-hearts-container');
            const heartSVG = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>`;

            State.letterHeartInterval = setInterval(() => {
                const div = document.createElement('div');
                div.classList.add('bg-heart');
                div.innerHTML = heartSVG;
                div.style.left = Math.random() * 100 + '%';
                div.style.color = '#f43f5e';
                div.style.opacity = '0.5';
                div.style.animationDuration = (Math.random() * 4 + 6) + 's';
                container.appendChild(div);
                setTimeout(() => div.remove(), 8000);
            }, 350);
        }

        function stopLetterHearts() {
            clearInterval(State.letterHeartInterval);
            const container = document.getElementById('letter-hearts-container');
            if (container) container.innerHTML = '';
        }

        /* --- Visuals: Transparent Floating Hearts (Boing Effect) --- */
        function generateFloatingHearts() {
            const container = document.getElementById('floating-hearts-container');
            const heartSVG = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>`;

            for (let i = 0; i < 20; i++) {
                const div = document.createElement('div');
                div.classList.add('bg-heart');
                div.innerHTML = heartSVG;
                div.style.left = Math.random() * 100 + '%';
                div.style.width = (Math.random() * 30 + 10) + 'px';
                div.style.height = div.style.width;
                div.style.animationDelay = Math.random() * 5 + 's';
                div.style.animationDuration = (Math.random() * 5 + 10) + 's';
                container.appendChild(div);
            }
        }

        function startCelebrationHearts() {
            const container = document.getElementById('celebration-hearts-container');
            const heartSVG = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>`;

            if (State.celebrationInterval) clearInterval(State.celebrationInterval);

            State.celebrationInterval = setInterval(() => {
                const div = document.createElement('div');
                div.classList.add('bg-heart');
                div.innerHTML = heartSVG;
                div.style.left = Math.random() * 100 + '%';
                div.style.bottom = '-50px';
                div.style.color = '#e11d48';
                div.style.opacity = '0.6';
                div.style.animationDuration = (Math.random() * 3 + 4) + 's';
                container.appendChild(div);
                setTimeout(() => { div.remove(); }, 7000);
            }, 300);
        }

        function stopCelebrationHearts() {
            if (State.celebrationInterval) clearInterval(State.celebrationInterval);
            const container = document.getElementById('celebration-hearts-container');
            if (container) container.innerHTML = '';
        }

        /* --- Cosmic Canvas Logic (New Feature) --- */
        function initCosmicCanvas() {
            const canvas = document.getElementById('cosmic-canvas');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            let width, height;
            let particles = [];
            let mouseX = 0, mouseY = 0;

            function resize() {
                width = canvas.width = window.innerWidth;
                height = canvas.height = window.innerHeight;
            }

            function createParticles() {
                particles = [];
                const count = Math.floor((width * height) / 15000);
                for (let i = 0; i < count; i++) {
                    particles.push({
                        x: Math.random() * width,
                        y: Math.random() * height,
                        vx: (Math.random() - 0.5) * 0.3,
                        vy: (Math.random() - 0.5) * 0.3,
                        radius: Math.random() * 2 + 1,
                        color: `hsla(${340 + Math.random() * 30}, 70%, ${60 + Math.random() * 20}%, ${0.3 + Math.random() * 0.4})`
                    });
                }
            }

            function animate() {
                ctx.clearRect(0, 0, width, height);
                // Draw gradient background
                const gradient = ctx.createRadialGradient(width / 2, height / 2, 0, width / 2, height / 2, width);
                gradient.addColorStop(0, '#fff5f6');
                gradient.addColorStop(1, '#fce7f3');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, width, height);

                particles.forEach(p => {
                    const dx = mouseX - p.x;
                    const dy = mouseY - p.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    if (dist < 150) {
                        p.x -= dx * 0.01;
                        p.y -= dy * 0.01;
                    }
                    p.x += p.vx;
                    p.y += p.vy;

                    if (p.x < 0) p.x = width;
                    if (p.x > width) p.x = 0;
                    if (p.y < 0) p.y = height;
                    if (p.y > height) p.y = 0;

                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                    ctx.fillStyle = p.color;
                    ctx.fill();
                });
                requestAnimationFrame(animate);
            }

            window.addEventListener('resize', () => { resize(); createParticles(); });
            document.addEventListener('mousemove', (e) => { mouseX = e.clientX; mouseY = e.clientY; });

            resize();
            createParticles();
            animate();
        }
    </script>
</body>
</html>
